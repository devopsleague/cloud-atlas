.. _think_server_fanless:

==========================
无风扇服务器构思
==========================

我现在用于学习和实践的主机是我购买的二手 :ref:`hpe_dl360_gen9` ，不过正如所有机架服务器一样，服务器噪音(主要是风扇)让人非常头疼。对于家用来说，其实无风扇的静音ARM服务器 :ref:`pi_stack` 更为适用。

服务器的噪音主要源自风扇，特别是机架式服务器内部空间有限，所以在散热上采用了非常强劲的特制风扇来形成前后气流带走服务器大量的热量(CPU和GPU)。既然将服务器作为家用，消除风扇就是保持宁静的必由之路(软硬件结合):

- :ref:`cpufreq` 可以将处理器的主频压低: 对于我个人的技术实践，通常不是追求硬件性能，而是实践各种软件部署和开发，所以如果通过压低处理器主频可以实现功耗大幅降低，也就向fanless服务器迈进了一大步
- 我在服务器上安装的 :ref:`tesla_p10` 虽然也是无风扇的GPU计算开，但是依然是耗电大户，通过在合理范围降低主频来满足fanless需求: :ref:`nvidia_gpu_mem_clock`
- 其他磁盘、内存也是存在一定功耗热量，可能也需要通过降频来减轻负担
- 我当时购买二手服务器，采用的是最常规廉价的Xeon E5-2670 v3 @ 2.30GHz，这款处理器是120W的常规CPU。Intel在每代志强处理器的系列中，都会有几款低功率CPU。对于我的 :ref:`hpe_dl360_gen9` 采用X99主板，能够支持两代Intel Xeon E5处理器(v3和v4)。如果当前处理器不能满足无风扇运行，我准备购买Intel E5 v4一代中最低功耗处理器 E5-2650Lv4，这款低电压处理器可以压缩到 65W功率

.. note::

   Intel Xeon E5-2650Lv4，目前在淘宝上大约 250~300 元

参考思路
===========

`全被动散热且无风扇的静音电脑可以实现吗？ <https://www.zhihu.com/question/296998101/answer/953799743>`_ 知乎网友探索无风扇主机的方式主要是:

- 定制机箱和散热器: 机箱盖板通过CNC加工纯金属散热鳍片，CPU和GPU散热导管直接连接在机箱散热鳍片上，加大散热速度(看了一下无风扇机箱报价5200+RMB，劝退)

.. note::

   机箱本身做成一个绝大的全铝散热器，CPU和显卡的热量通过热管传导到全铝机箱进行散热:

   - 机箱价格昂贵，对电脑配置的选择限制很多(因为是定制机箱，需要完全匹配硬件规格)
   - 散热必须快于CPU/GPU的热量积累，否则还是会导致积热影响运行

- 使用非常夸张的散热器(CPU和GPU都需要超大散热器)，不使用主机盖板或者直接全裸，只使用固态硬盘，并且推荐 `AMD APU <https://www.zhihu.com/topic/19598742/hot>`_ (毕竟AMD的Radeon显卡性能优于Intel集显)

.. note::

   全裸机箱充满工业风和赛博朋克风范，除了容易积灰之外没有其他缺点:

   .. figure:: ../../../../_static/linux/server/hardware/fanless/host_fanless.png

- `Airtop2 – build-to-order <https://fit-iot.com/web/product/airtop2-build-to-order/>`_ 定制小型桌面无风扇主机(商品化产品)
- :strike:`使用二甲基硅油作为冷却液，主机浸泡在鱼缸中` 的 `【折腾狂】极端机箱散热方案：油冷 <https://post.smzdm.com/p/163350/>`_ (其实鱼缸散热不佳，方案虽然好玩但不实用)

我的方案思路
==============

- 通过 :ref:`cpufreq` 配置 ``powersave`` governor ，将处理器主频始终压制在最低(如果升级了 ``E5-2650Lv4`` 是否可以选择 ``ondemand`` ?)
- 我的GPU是 :ref:`tesla_p10` 已经是NVIDIA Tesla卡中降频低功率版本，不过我准备进一步通过 :ref:`nvidia_gpu_mem_clock` 来降低热量
- 如果通过降频CPU温控依然无法达到理想状态(无风扇)，考虑追加投资 ``E5-2650Lv4`` ，这是我的二手 :ref:`hpe_dl360_gen9` 能够支持的最高一代(X99主板支持Xeon E5 v3和v4)，这款低电压CPU可以把功率从常规的120W降低到65W(预计投入500RMB)
- 既然无风扇服务器，那么散热主要靠散热片自然对流，所以服务器不盖机箱盖板。但是，自己家用，没有盖板会导致灰尘。所以准备购买 ``磁吸PVC电脑主机箱防尘网`` 来满足散热同时能够隔绝灰尘

探索方案
============

- 服务器默认不能没有风扇启动(启动时会加速风扇高速转动) ，所以需要配置BIOS来实现 :ref:`hpe_dl360_gen9_without_fan`
- 采用 :ref:`cpufreq` 的 ``powersave`` governor 使得处理器主频始终在最低频率运行( 必要时购买 Xeon E5-2650Lv4 来进一步压低功率 )
- 部署 :ref:`prometheus` 以及安装 :ref:`prometheus_exporters` 实现服务器完整的硬件监控(温度、主频)，这样能够对比启用风扇和关闭风扇的差异
- 考虑通过软件控制风扇转速，通过软件关闭服务器风扇，并在极端情况下恢复风扇运行

参考
======

- `家庭AIO的终点，FANLESS无风扇服务器，装机教程 <https://post.smzdm.com/p/ao9emq47/>`_ (对应视频 `家庭AIO的终点，FANLESS无风扇服务器，装机教程(B站视频) <https://www.bilibili.com/video/BV1bg411r7am/>`_ )
- `全被动散热且无风扇的静音电脑可以实现吗？ <https://www.zhihu.com/question/296998101/answer/953799743>`_ 
